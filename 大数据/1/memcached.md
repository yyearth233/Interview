# Memcached

#### 1.简介

高性能分布式内存缓存，缓存数据库查询结果，减少数据库查询次数。
使用 CRC32 32 位循环冗余校验计算键值，将数据分布在不同的节点上。
当缓存满了采用 LRU 机制删除。

#### 2. 分布式算法
* 余数哈希：哈希值对节点个数取余。根据余数选存储的节点。增删服务器导致所有缓存数据都作废。
* 一致性哈希：整个哈希空间组成以一个环 0 ～ 2^32 - 1，每个节点负责一个区域。增删服务器不会所有数据都丢失。

#### 3. 数据清除算法 LRU 算法
每个 slab 会维护一个队列，刚插入的数据在队头，经常 get 的数据也会移动到队头，这样较老或者访问较少的数据留在队尾。
当队列满了之后从队尾开始淘汰。
当 slab 分配不到足够的内存时，首先会检查队尾是否有过期数据。如果有，删除，如果没有，会开始淘汰队尾的对象。

Slab 是一个内存块，它是 memcached 一次申请内存的最小单位 1M（1048576 Byte），一个 slab 由若干个大小相等的chunk 组成。每个 chunk 中都保存了一个 item 结构体、一对 key 和 value。


#### 4. memcached 工作流程

检查请求数据是否在 memcached 中，如有，直接把请求数据返回；如果没有，就去查数据库，把从数据库中获取的数据返回给客户端，同时把数据缓存一份到 memcached 中（memcached 客户端不负责，需要程序明确实现）。
每次更新数据库的同时更新 memcached 中的数据，保证一致性；
当分配给 memcached 内存空间用完之后，会使用 LRU 策略加上到期失效策略，失效数据首先被替换，然后再替换掉最近未使用的数据。

#### 5. memcached 与 redis 的区别

1) memcache 只支持 string 类型的 KV 数据，只进行二进制存储，序列化反序列化都要自己实现，redis 支持 KV，string, list, set, zset等类型。
2) redis 支持数据备份，master-slave 模式
3) redis 支持数据持久化，memcache 仅保存在内存中。
4) memcache 多线程非阻塞 IO，redis 单线程 IO 复用模型。

有持久化和数据结构，高级要求的选 redis。
简单 KV 存储选 memcache。

